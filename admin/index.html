<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="UTF-8">
  <title>Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
  body{margin:0;padding:20px;font-family:Arial,sans-serif;background:#f5f0dc;color:#000;}
  .team-row{margin-bottom:30px;padding-bottom:20px;border-bottom:1px solid #d1c7b7;}
  .team-name{font-weight:bold;margin-bottom:10px;}
  .progress-wrapper{overflow-x:auto;padding:10px 0;}
  .steps{display:flex;position:relative;gap:20px;}
  .step{display:flex;flex-direction:column;align-items:center;font-size:12px;cursor:pointer;flex:0 0 auto;}
  .dot{width:16px;height:16px;border-radius:50%;border:2px solid #d1c7b7;background:#fffbea;margin-bottom:4px;}
  .step.current .dot{background:#d1c7b7;}
  .step.selected .dot{background:#f2e8d5;}
  button{padding:6px 12px;border:2px solid #d1c7b7;background:#fffbea;cursor:pointer;}
  button:hover{background:#f2e8d5;}
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
  <div id="teams"></div>
<script>
const firebaseConfig={
  apiKey:"AIzaSyBLWYpv72R8z4XwZE6F2y9mdy4HDdiqkHc",
  authDomain:"city-scavenger-hunt-2025.firebaseapp.com",
  databaseURL:"https://city-scavenger-hunt-2025-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:"city-scavenger-hunt-2025",
  storageBucket:"city-scavenger-hunt-2025.firebasestorage.app",
  messagingSenderId:"950959276332",
  appId:"1:950959276332:web:cbbd2bd8dc49619aa42c89",
  measurementId:"G-5GE9NWQ1YP"
};
let db;
let teams=[];
function init(){
  const app=firebase.initializeApp(firebaseConfig);
  db=firebase.database(app);
  db.ref('cityScavengerHunt').on('value',snap=>{
    teams=snap.val()||[];
    render();
  });
}
function render(){
  const container=document.getElementById('teams');
  container.innerHTML='';
  teams.forEach((t,i)=>{
    const row=document.createElement('div');
    row.className='team-row';
    const name=document.createElement('div');
    name.className='team-name';
    name.textContent='Team '+(t.team||i+1);
    row.appendChild(name);
    const wrap=document.createElement('div');
    wrap.className='progress-wrapper';
    const stepsEl=document.createElement('div');
    stepsEl.className='steps';
    const seq=t.sequence||[];
    let selIndex=typeof t.current==='number'?t.current:0;
    seq.forEach((s,idx)=>{
      const step=document.createElement('div');
      step.className='step';
      if(idx===selIndex) step.classList.add('current');
      const dot=document.createElement('div');
      dot.className='dot';
      const label=document.createElement('div');
      label.textContent=s;
      step.appendChild(dot);
      step.appendChild(label);
      step.onclick=()=>{
        stepsEl.querySelectorAll('.step').forEach(d=>d.classList.remove('selected'));
        step.classList.add('selected');
        selIndex=idx;
      };
      stepsEl.appendChild(step);
    });
    wrap.appendChild(stepsEl);
    row.appendChild(wrap);
    const btn=document.createElement('button');
    btn.textContent='確認';
    btn.onclick=()=>{
      db.ref('cityScavengerHunt/'+i).update({current:selIndex});
    };
    row.appendChild(btn);
    container.appendChild(row);
  });
}
window.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>
